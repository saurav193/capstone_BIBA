y_train
y_valid <- y_valid %>%
select(unacast_session_count)
y_train
y_train
y_train <- y_train %>%
select(unacast_session_count)
y_valid <- y_valid %>%
select(unacast_session_count)
y_train
y_valid
X_train %>%
mutate(target = y_train)
X_train
y_train
y_train <- y_train$unacast_session_count
y_valid <- y_valid$unacast_session_count
y_train
X_train %>%
mutate(target = y_train)
X_t <- X_train %>%
mutate(target = y_train)
X_t$target
X_t <- X_train %>%
mutate(target = y_train - 300)
X_t$target
poisson <- glm(target ~ ., family=poisson, data=X_t
poisson <- glm(target ~ ., family=poisson, data=X_t)
glm(formula = target ~ ., family = poisson(), data = X_t)
poisson <- glm(formula = target ~ ., family = "poisson", data = X_t)
poisson
poisson %>%
broom::tidy()
X_valid
X_valid[:20]
X_valid[:, :20]
X_valid[:, 1:20]
X_valid[:, 1:20]
X_valid %>%
top_n(10)
X_valid_test <- X_valid %>%
top_n(10)
predict(poisson, X_valid_test, type="response")
tidy::broom()
predict(poisson, X_valid_test, type="response") %>%
broom::tidy()
predict(poisson, X_valid, type="response") %>%
broom::tidy()
y_valid
len(y_valid)
length(y_valid)
predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300)
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
select(x)
data.frame(y_pred, y_valid)
data.frame(y_pred, y_valid) %>%
mutate(residuals = y_valid - y_pred)
data.frame(y_pred, y_valid) %>%
mutate(residual = y_valid - y_pred)
data.frame(y_pred, y_valid) %>%
data.frame(y_pred, y_valid)
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
select(x)
data.frame(y_pred, y_valid)
data.frame(y_pred, y_valid) %>%
mutate(res = y-valid - x)
data.frame(y_pred, y_valid) %>%
mutate(res = y_valid - x)
plot_df data.frame(y_pred, y_valid) %>%
plot_df <- data.frame(y_pred, y_valid) %>%
mutate(res = y_valid - x)
ggplot(plot_df, aes(x=y_valid, y=res)) +
geom_point()
rmse(y_valid, plot_df$y_pred)
plot_df$y_pred
plot_df
rmse(y_valid, plot_df$x)
plot_df
plot_df %>%
select(res) %>%
max()
plot_df$x
plot_df$y_valid
rmse(plot_df$y_valid, plot_df$x)
rmse(y_valid, y_pred)
rmse(y_valid, y_pred)
rmse(y_valid, y_pred)
typeof(y_valid)
typeof(y_pred)
y_pred
plot_df <- data.frame(y_pred$x, y_valid) %>%
mutate(res = y_valid - x)
plot_df <- data.frame(y_pred, y_valid) %>%
mutate(res = y_valid - x)
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
select(x)
y_pred
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
y_pred
rmse(y_pred, y_valid)
library(Metrics)
install.packages("Metrics")
library(tidyverse)
library(modelr)
library(caret)
library(Metrics)
rmse(poisson, X_t)
modelr::rmse(poisson, X_t)
y_pred
y_valid
y_pred
len(y_pred)
length(y_pred)
length(y_valid)
data.frame(y_valid, y_pred)
data.frame(y_valid, y_pred) %>%
mutate(res = y_valid - y_pred)
plot_df <- data.frame(y_valid, y_pred) %>%
mutate(res = y_valid - y_pred)
ggplot(plot_df, aes(y_valid, res)) +
geom_scatter()
ggplot(plot_df, aes(y_valid, res)) +
geom_point()
plot_df
plot_df %>%
select(res) %>%
min()
plot_df %>%
arrange(res)
plot_df %>%
filter(y_valid != 3039)
plot_df <- plot_df %>%
filter(y_valid != 3039)
ggplot(plot_df, aes(y_valid, res)) +
geom_point()
exp <- glm(formula = target ~ ., family = "exp", data = X_t)
exp <- glm(formula = target ~ ., family = "exponential", data = X_t)
poisson <- glm(formula = target ~ ., family = "poisson", data = X_t)
poisson %>%
broom::tidy()
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
plot_df %>%
arrange(res)
poisson <- glm(formula = target ~ ., family = poisson(link = "log"), data = X_t)
poisson %>%
broom::tidy()
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
plot_df <- data.frame(y_valid, y_pred) %>%
mutate(res = y_valid - y_pred)
plot_df %>%
arrange(res)
ggplot(plot_df, aes(y_valid, res)) +
geom_point()
y_pred_t <- predict(poisson, X_train, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
plot_df_t %>%
arrange(res)
plot_df_t <- data.frame(y_train, y_pred_t) %>%
mutate(res = y_train - y_pred_t)
plot_df_t %>%
arrange(res)
ggplot(plot_df_t, aes(y_train, res)) +
geom_point()
poisson <- glm(formula = target ~ ., family = poisson(link = "identity"), data = X_t)
library(MASS)
nb <- glm.nb(formula = target ~ ., data = X_t)
nb <- glm.nb(formula = target ~ ., data = X_t, link=log)
nb <- glm(formula = target ~ ., family=inverse.gaussian(link = "1/mu^2"), data = X_t, link=log)
nb <- glm(formula = target ~ ., family=inverse.gaussian(link = "1/mu^2"), data = X_t)
poisson <- glm(formula = target ~ ., family = quasipoisson(link = "identity"), data = X_t)
poisson <- glm(formula = target ~ ., family = poisson(link = "identity"), data = X_t)
poisson <- glm(formula = target ~ ., family = quasipoisson(link = "log"), data = X_t)
poisson %>%
broom::tidy()
y_pred_t <- predict(poisson, X_train, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
plot_df_t <- data.frame(y_train, y_pred_t) %>%
mutate(res = y_train - y_pred_t)
plot_df_t %>%
arrange(res)
ggplot(plot_df_t, aes(y_train, res)) +
geom_point()
y_pred <- predict(poisson, X_valid, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
plot_df <- data.frame(y_valid, y_pred) %>%
mutate(res = y_valid - y_pred)
plot_df %>%
arrange(res)
ggplot(plot_df, aes(y_valid, res)) +
geom_point()
y_valid_l <- read_csv("data/y_valid_lo.csv")
setwd("C:/Users/reiko/Desktop/capstone_machine_learning")
X_train_l <- read_csv("data/X_train_lo.csv")
y_valid_l <- read_csv("../data/y_valid_lo.csv")
X_train <- X_train %>%
select(-X1)
X_t_lo <- X_train_lo %>%
mutate(target = y_train_lo)
X_train_lo <- X_train_lo %>%
select(-X1)
X_train_l <- X_train_l %>%
select(-X1)
X_train_l <- X_train_l %>%
select(-X1)
X_train_l <- read_csv("../data/X_train_lo.csv")
X_valid_l <- read_csv("../data/X_valid_lo.csv")
y_train_l <- read_csv("../data/y_train_lo.csv")
y_valid_l <- read_csv("../data/y_valid_lo.csv")
X_train_l <- X_train_l %>%
select(-X1)
head(X_train_l)
head(X_valid_l)
X_train_l <- X_train_l %>%
select(-X1)
X_train_l <- X_train_l %>%
select(- X1)
X_train_l <- X_train_l %>%
select(- X1)
X_train_1
X_train_l
X_train_l %>%
select(-X1)
X_valid_l <- X_valid_l %>%
tidyverse::select(-X1)
X_valid_l <- X_valid_l %>%
dplyr::select(-X1)
X_t_l <- X_train_l %>%
mutate(target = y_train_l)
X_t_l <- X_train_l %>%
dplyr::mutate(target = y_train_l)
y_train_l
X_train_l <- X_train_l %>%
dplyr::select(-X1)
X_valid_l <- X_valid_l %>%
dplyr::select(-X1)
y_train_l <- y_train_l$unacast_session_count
y_valid_l <- y_valid_l$unacast_session_count
X_t_l <- X_train_l %>%
dplyr::mutate(target = y_train_l)
poisson_l <- glm(formula = target ~ ., family = quasipoisson(link = "log"), data = X_t_l)
poisson_l %>%
broom::tidy()
y_pred_l <- predict(poisson_l, X_valid_l, type="response") %>%
broom::tidy() %>%
pull(x)
ggplot(plot_df_t_l, aes(y_valid_l, res)) +
geom_point()
y_pred_l <- predict(poisson_l, X_valid_l, type="response") %>%
broom::tidy() %>%
pull(x)
plot_df_t_l <- data.frame(y_valid_l, y_pred_l) %>%
mutate(res = y_valid_l - y_pred_l)
plot_df_t_l %>%
arrange(res)
ggplot(plot_df_t_l, aes(y_valid_l, res)) +
geom_point()
y_valid_l
y_pred_l
RMSE(plot_df_t_l$y_pred_l, plot_df_t_l$y_valid_l)
poisson_l <- glm(formula = target ~ ., family = poisson(link = "log"), data = X_t_l)
poisson_l %>%
broom::tidy()
y_pred_l <- predict(poisson_l, X_valid_l, type="response") %>%
broom::tidy() %>%
pull(x)
plot_df_t_l <- data.frame(y_valid_l, y_pred_l) %>%
mutate(res = y_valid_l - y_pred_l)
plot_df_t_l %>%
arrange(res)
ggplot(plot_df_t_l, aes(y_valid_l, res)) +
geom_point()
RMSE = function(m, o){
sqrt(mean((m - o)^2))
}
RMSE(plot_df_t_l$y_pred_l, plot_df_t_l$y_valid_l)
poisson_l <- glm.nb(formula = target ~ ., data = X_t_l, link=log)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(modelr)
library(MASS)
library(tidyverse)
library(modelr)
library(MASS)
X_train <- read_csv("data/X_train_hi.csv")
X_train <- read_csv("../data/X_train_hi.csv")
X_valid <- read_csv("data/X_valid_hi.csv")
X_train <- read_csv("../data/X_train_hi.csv")
X_valid <- read_csv("../data/X_valid_hi.csv")
y_train <- read_csv("../data/y_train_hi.csv")
y_valid <- read_csv("../data/y_valid_hi.csv")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(modelr)
library(MASS)
X_train_hi <- read_csv("../data/X_train_hi.csv")
X_valid_hi <- read_csv("../data/X_valid_hi.csv")
y_train_hi <- read_csv("../data/y_train_hi.csv")
y_valid_hi <- read_csv("../data/y_valid_hi.csv")
X_train_lo <- read_csv("../data/X_train_lo.csv")
X_valid_lo <- read_csv("../data/X_valid_lo.csv")
y_train_lo <- read_csv("../data/y_train_lo.csv")
y_valid_lo <- read_csv("../data/y_valid_lo.csv")
poisson_hi <- glm(formula = target ~ ., family = "poisson", data = X_train_hi_model)
X_train_hi <- X_train_hi %>%
select(-X1)
X_valid_hi <- X_valid_hi %>%
dpylr::select(-X1)
X_train_hi <- X_train_hi %>%
dyplr::select(-X1)
X_train_hi <- X_train_hi %>%
dplyr::select(-X1)
X_valid_hi <- X_valid_hi %>%
dplyr::select(-X1)
y_train_hi <- y_train_hi$unacast_session_count
y_valid_hi <- y_valid_hi$unacast_session_count
X_train_hi_model <- X_train_hi %>%
mutate(target = y_train_hi - 300)
X_train_hi <- X_train_hi %>%
dplyr::select(-X1)
poisson_hi <- glm(formula = target ~ ., family = "poisson", data = X_train_hi_model)
poisson_hi %>%
broom::tidy()
y_pred_train <- predict(poisson_hi, X_train_hi, type="response") %>%
broom::tidy() %>%
pull(x)
y_pred_train_lo <- predict(poisson_hi, X_train_hi, type="response") %>%
broom::tidy() %>%
pull(x)
lo_train <- data.frame(y_train_lo, y_pred_train_lo) %>%
mutate(res = y_train_lo - y_pred_train_lo)
X_train_lo <- X_train_lo %>%
dplyr::select(-X1)
X_valid_lo <- X_valid_lo %>%
dplyr::select(-X1)
y_train_lo <- y_train_lo$unacast_session_count
y_valid_lo <- y_valid_lo$unacast_session_count
X_train_lo_model <- X_train_lo %>%
mutate(target = y_train_lo - 300)
poisson_lo <- glm(formula = target ~ ., family = "poisson", data = X_train_lo_model)
X_train_hi <- X_train_hi %>%
dplyr::select(-X1)
poisson_hi <- glm(formula = target ~ ., family = "poisson", data = X_train_hi_model)
poisson_hi %>%
broom::tidy()
ggplot(hi_train, aes(y_train_hi, res)) +
geom_point()
y_pred_train_hi <- predict(poisson_hi, X_train_hi, type="response") %>%
broom::tidy() %>%
pull(x)
hi_train <- data.frame(y_train_hi, y_pred_train_hi) %>%
mutate(res = y_train_hi - y_pred_train_hi)
ggplot(hi_train, aes(y_train_hi, res)) +
geom_point()
library(Metrics)
Metrics::rmse(plot_df_t_l$y_pred_l, plot_df_t_l$y_valid_l)
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
y_pred_train_hi <- predict(poisson_hi, X_train_hi, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300)
pull(x)
y_pred_train_hi
y_pred_train_hi <- predict(poisson_hi, X_train_hi, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
y_pred_train_hi
ggplot(hi_train, aes(y_train_hi, res)) +
geom_point()
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
y_pred_train_hi <- predict(poisson_hi, X_train_hi, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
hi_train <- data.frame(y_train_hi, y_pred_train_hi) %>%
mutate(res = y_train_hi - y_pred_train_hi)
ggplot(hi_train, aes(y_train_hi, res)) +
geom_point()
Metrics::rmse(hi_train$y_train_hi, hi_train$y_pred_train_hi)
y_pred_valid_hi <- predict(poisson_hi, X_valid_hi, type="response") %>%
broom::tidy() %>%
mutate(x = x + 300) %>%
pull(x)
hi_valid <- data.frame(y_valid_hi, y_pred_valid_hi) %>%
mutate(res = y_valid_hi - y_pred_valid_hi)
ggplot(hi_valid, aes(y_valid_hi, res)) +
geom_point()
Metrics::rmse(hi_valid$y_valid_hi, hi_valid$y_pred_valid_hi)
X_train_lo <- X_train_lo %>%
dplyr::select(-X1)
#X_train_lo <- X_train_lo %>%
#  dplyr::select(-X1)
X_valid_lo <- X_valid_lo %>%
dplyr::select(-X1)
#X_train_lo <- X_train_lo %>%
#  dplyr::select(-X1)
#X_valid_lo <- X_valid_lo %>%
#  dplyr::select(-X1)
y_train_lo <- y_train_lo$unacast_session_count
X_train_lo <- read_csv("../data/X_train_lo.csv")
X_valid_lo <- read_csv("../data/X_valid_lo.csv")
y_train_lo <- read_csv("../data/y_train_lo.csv")
y_valid_lo <- read_csv("../data/y_valid_lo.csv")
X_train_lo <- X_train_lo %>%
dplyr::select(-X1)
X_valid_lo <- X_valid_lo %>%
dplyr::select(-X1)
y_train_lo <- y_train_lo$unacast_session_count
y_valid_lo <- y_valid_lo$unacast_session_count
X_train_lo_model <- X_train_lo %>%
mutate(target = y_train_lo)
poisson_lo <- glm(formula = target ~ ., family = "poisson", data = X_train_lo_model)
poisson_lo %>%
broom::tidy()
y_pred_train_lo <- predict(poisson_lo, X_train_lo, type="response") %>%
broom::tidy() %>%
pull(x)
lo_train <- data.frame(y_train_lo, y_pred_train_lo) %>%
mutate(res = y_train_lo - y_pred_train_lo)
ggplot(lo_train, aes(y_train_lo, res)) +
geom_point()
Metrics::rmse(lo_train$y_train_lo, lo_train$y_pred_train_lo)
y_pred_valid_lo <- predict(poisson_lo, X_valid_lo, type="response") %>%
broom::tidy() %>%
pull(x)
lo_valid <- data.frame(y_valid_lo, y_pred_valid_lo) %>%
mutate(res = y_valid_lo - y_pred_valid_lo)
ggplot(lo_valid, aes(y_valid_lo, res)) +
geom_point()
Metrics::rmse(lo_valid$y_valid_lo, lo_valid$y_pred_valid_lo)
hi_valid
hi_valid %>%
arrange(res)
hi_valid %>%
arrange(res) %>%
head(1)
hi_valid %>%
arrange(res) %>%
head(1) %>%
pull(y_valid_hi)
X_train_model_lo
X_train_lo_model
X_train_lo_model %>%
filter(target == outlier)
outlier <- hi_valid %>%
arrange(res) %>%
head(1) %>%
pull(y_valid_hi)
X_train_lo_model %>%
filter(target == outlier)
X_valid_lo_model %>%
filter(target == outlier)
outlier <- hi_valid %>%
arrange(res) %>%
head(1) %>%
pull(y_valid_hi)
X_valid_lo_model %>%
filter(target == outlier)
outlier <- hi_valid %>%
arrange(res) %>%
head(1) %>%
pull(y_valid_hi)
X_valid_lo_w_target <- X_valid_lo %>%
mutate(target = y_valid_lo)
X_valid_lo_w_target %>%
filter(target == outlier)
outlier
y_valid_lo == 3039
y_valid_lo[y_valid_lo == 3039]
X_valid_hi_w_target %>%
filter(target == outlier)
X_valid_hi_w_target <- X_valid_hi %>%
mutate(target = y_valid_hi)
X_valid_hi_w_target %>%
filter(target == outlier)
#X_valid_hi_w_target %>%
#  filter(target == outlier)
outlier
outlier <- hi_valid %>%
arrange(res) %>%
head(1) %>%
pull(y_valid_hi)
X_valid_hi_w_target <- X_valid_hi %>%
mutate(target = y_valid_hi)
X_valid_hi_w_target %>%
filter(target == outlier)
